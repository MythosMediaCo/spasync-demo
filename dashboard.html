<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MedSpaSync Pro - Dashboard</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/lucide-react@latest/dist/umd/lucide-react.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="./api-service.js"></script>
    <style>
        .gradient-bg {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
        }
        .card-shadow {
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        }
        .glass-effect {
            backdrop-filter: blur(16px);
            background: rgba(255, 255, 255, 0.95);
        }
        .report-card {
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }
        .report-card:hover {
            border-color: #3B82F6;
            transform: translateY(-2px);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        }
        .metric-card {
            transition: all 0.3s ease;
        }
        .metric-card:hover {
            transform: translateY(-1px);
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.15);
        }
        .status-badge {
            display: inline-flex;
            align-items: center;
            gap: 0.25rem;
        }
        .icon-pulse {
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
        .icon-bounce {
            animation: bounce 1s infinite;
        }
        .icon-spin-slow {
            animation: spin 3s linear infinite;
        }
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        @media print {
            .no-print { display: none; }
            .print-only { display: block; }
        }
        .print-only { display: none; }
        .file-type-icon {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 2rem;
            height: 2rem;
            border-radius: 0.375rem;
            font-size: 0.75rem;
            font-weight: 600;
        }
        .action-button {
            transition: all 0.2s ease;
        }
        .action-button:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }
    </style>
</head>
<body class="gradient-bg">
    <div id="dashboard-root">
        <div class="flex items-center justify-center min-h-screen bg-gray-50">
            <div class="text-center">
                <div class="animate-spin rounded-full h-16 w-16 border-b-4 border-blue-600 mx-auto"></div>
                <p class="mt-6 text-xl text-gray-600">Loading MedSpaSync Pro Dashboard...</p>
                <p class="mt-2 text-sm text-gray-500">Connecting to your reconciliation system</p>
            </div>
        </div>
    </div>
    
    <script type="text/babel">
        const { useState, useEffect, useRef } = React;
        
        // ✅ COMPREHENSIVE ICON SYSTEM
        const createIcon = (iconName) => {
            if (typeof LucideReact !== 'undefined' && LucideReact[iconName]) {
                return LucideReact[iconName];
            }
            return (props) => React.createElement('div', {
                ...props,
                className: `${props.className} inline-block w-5 h-5 bg-gray-400 rounded`,
                title: iconName
            });
        };

        // Core Icons
        const Upload = createIcon('Upload');
        const FileText = createIcon('FileText');
        const BarChart3 = createIcon('BarChart3');
        const Users = createIcon('Users');
        const DollarSign = createIcon('DollarSign');
        const Clock = createIcon('Clock');
        const CheckCircle = createIcon('CheckCircle');
        const AlertTriangle = createIcon('AlertTriangle');
        const XCircle = createIcon('XCircle');
        const Download = createIcon('Download');
        const RefreshCw = createIcon('RefreshCw');
        const Settings = createIcon('Settings');
        const LogOut = createIcon('LogOut');
        const AlertCircle = createIcon('AlertCircle');
        const TrendingUp = createIcon('TrendingUp');
        const Calendar = createIcon('Calendar');

        // Enhanced Icons for Better UX
        const PieChart = createIcon('PieChart');
        const BarChart = createIcon('BarChart');
        const FileSpreadsheet = createIcon('FileSpreadsheet');
        const Printer = createIcon('Printer');
        const Eye = createIcon('Eye');
        const EyeOff = createIcon('EyeOff');
        const Star = createIcon('Star');
        const Shield = createIcon('Shield');
        const Zap = createIcon('Zap');
        const Target = createIcon('Target');
        const Award = createIcon('Award');
        const Briefcase = createIcon('Briefcase');
        const Database = createIcon('Database');
        const Server = createIcon('Server');
        const Cpu = createIcon('Cpu');
        const Activity = createIcon('Activity');
        const Layers = createIcon('Layers');
        const Filter = createIcon('Filter');
        const Search = createIcon('Search');
        const Bell = createIcon('Bell');
        const Home = createIcon('Home');
        const FolderOpen = createIcon('FolderOpen');
        const FileCheck = createIcon('FileCheck');
        const FileX = createIcon('FileX');
        const FilePlus = createIcon('FilePlus');
        const TrendingDown = createIcon('TrendingDown');
        const ArrowUp = createIcon('ArrowUp');
        const ArrowDown = createIcon('ArrowDown');
        const ArrowRight = createIcon('ArrowRight');
        const ChevronRight = createIcon('ChevronRight');
        const Play = createIcon('Play');
        const Pause = createIcon('Pause');
        const Square = createIcon('Square');
        const RotateCcw = createIcon('RotateCcw');
        const CheckCircle2 = createIcon('CheckCircle2');
        const Info = createIcon('Info');
        const HelpCircle = createIcon('HelpCircle');
        const ExternalLink = createIcon('ExternalLink');
        const Copy = createIcon('Copy');
        const Share = createIcon('Share');
        const MoreHorizontal = createIcon('MoreHorizontal');
        const Grid = createIcon('Grid');
        const List = createIcon('List');
        const Hash = createIcon('Hash');
        const Percent = createIcon('Percent');
        const Plus = createIcon('Plus');
        const Minus = createIcon('Minus');
        const X = createIcon('X');
        const Check = createIcon('Check');

        const IntegratedMedSpaSyncDashboard = () => {
            const [user, setUser] = useState(null);
            const [uploads, setUploads] = useState([]);
            const [reconciliationResults, setReconciliationResults] = useState(null);
            const [stats, setStats] = useState(null);
            const [loading, setLoading] = useState(false);
            const [activeTab, setActiveTab] = useState('dashboard');
            const [dragActive, setDragActive] = useState(false);
            const [error, setError] = useState(null);
            const [uploadProgress, setUploadProgress] = useState(0);
            const [selectedUploadIds, setSelectedUploadIds] = useState([]);
            const [reconciliationSettings, setReconciliationSettings] = useState({
                matchCriteria: 'normal',
                dateToleranceDays: 7,
                amountTolerancePercent: 5
            });
            const [generatingReport, setGeneratingReport] = useState(false);
            const [reportHistory, setReportHistory] = useState([]);

            const [api] = useState(() => {
                if (typeof window !== 'undefined' && window.MedSpaSyncAPI) {
                    try {
                        console.log('Initializing production API connection...');
                        return new window.MedSpaSyncAPI();
                    } catch (e) {
                        console.error('Failed to initialize API:', e);
                        return null;
                    }
                }
                console.error('MedSpaSyncAPI not found - check if api-service.js is loaded');
                return null;
            });

            const fileInputRef = useRef(null);

            // ✅ ENHANCED FILE TYPE ICONS
            const getFileTypeIcon = (fileType) => {
                const icons = {
                    pos_transactions: { icon: Database, color: 'bg-blue-500', textColor: 'text-white' },
                    alle_rewards: { icon: Award, color: 'bg-green-500', textColor: 'text-white' },
                    aspire_certificates: { icon: Star, color: 'bg-purple-500', textColor: 'text-white' },
                    unknown: { icon: FileText, color: 'bg-gray-500', textColor: 'text-white' }
                };
                return icons[fileType] || icons.unknown;
            };

            // ✅ ENHANCED STATUS ICONS
            const getStatusIcon = (status) => {
                const statusIcons = {
                    processed: { icon: CheckCircle, color: 'text-green-600' },
                    processing: { icon: RefreshCw, color: 'text-blue-600 animate-spin' },
                    error: { icon: XCircle, color: 'text-red-600' },
                    pending: { icon: Clock, color: 'text-yellow-600' }
                };
                return statusIcons[status] || statusIcons.processed;
            };

            useEffect(() => {
                const initializeApp = async () => {
                    try {
                        if (!api) {
                            console.error('Cannot initialize - API service not available');
                            setError('API service not available. Please check if api-service.js is loaded correctly.');
                            return;
                        }

                        setLoading(true);
                        console.log('Initializing production dashboard...');

                        if (!api.isAuthenticated()) {
                            console.log('Not authenticated, redirecting to login');
                            window.location.href = 'login.html';
                            return;
                        }

                        console.log('Testing backend connection...');
                        await api.healthCheck();
                        console.log('Backend connection successful');

                        setUser({
                            firstName: "Test",
                            lastName: "User", 
                            email: "test@medspasync.com",
                            practice: {
                                name: "Demo Spa",
                                size: "small",
                                subscriptionTier: "trial"
                            }
                        });

                        console.log('Loading production data...');
                        await Promise.all([
                            loadUploadHistory(),
                            loadStats(),
                            loadReportHistory()
                        ]);

                        console.log('Production dashboard initialized successfully');

                    } catch (error) {
                        console.error('Failed to initialize app:', error);
                        setError(api ? api.handleError(error, 'Initialization') : 'Failed to initialize dashboard. Please refresh the page.');
                        
                        if (error.message && error.message.includes('Authentication required')) {
                            setTimeout(() => {
                                window.location.href = 'login.html';
                            }, 2000);
                        }
                    } finally {
                        setLoading(false);
                    }
                };

                initializeApp();
            }, [api]);

            const loadUploadHistory = async () => {
                try {
                    console.log('Loading real upload history from backend...');
                    const response = await api.getUploadHistory();
                    if (response.success) {
                        console.log('Upload history loaded:', response.uploads);
                        setUploads(response.uploads || []);
                        
                        const recentUploads = (response.uploads || []).slice(0, 3);
                        setSelectedUploadIds(recentUploads.map(u => u.id));
                    } else {
                        throw new Error(response.error || 'Failed to load upload history');
                    }
                } catch (error) {
                    console.error('Failed to load upload history:', error);
                    setError(api.handleError(error, 'Loading upload history'));
                }
            };

            const loadStats = async () => {
                try {
                    console.log('Loading real statistics from backend...');
                    const response = await api.getStats();
                    if (response.success) {
                        console.log('Statistics loaded:', response.stats);
                        setStats(response.stats);
                    } else {
                        console.warn('Failed to load stats:', response.error);
                    }
                } catch (error) {
                    console.error('Failed to load stats:', error);
                }
            };

            const loadReportHistory = async () => {
                try {
                    console.log('Loading report history...');
                    const mockReports = [
                        {
                            id: 1,
                            type: 'Executive Summary',
                            createdAt: new Date(Date.now() - 24 * 60 * 60 * 1000).toISOString(),
                            matches: 47,
                            matchRate: 91.2,
                            timeSaved: 8.5
                        },
                        {
                            id: 2,
                            type: 'Detailed Analysis',
                            createdAt: new Date(Date.now() - 7 * 24 * 60 * 60 * 1000).toISOString(),
                            matches: 52,
                            matchRate: 89.7,
                            timeSaved: 9.2
                        }
                    ];
                    setReportHistory(mockReports);
                } catch (error) {
                    console.error('Failed to load report history:', error);
                }
            };

            const handleFileUpload = async (files) => {
                if (!api) {
                    setError('API service not available');
                    return;
                }

                setLoading(true);
                setError(null);
                setUploadProgress(0);

                try {
                    const file = files[0];
                    console.log('Uploading file to production backend:', file.name, 'Size:', file.size);

                    const response = await api.uploadFile(file, (progress) => {
                        setUploadProgress(progress);
                        console.log('Upload progress:', progress + '%');
                    });

                    if (response.success) {
                        console.log('Upload successful:', response);
                        showNotification(`Successfully uploaded ${file.name}`, 'success');
                        
                        await Promise.all([
                            loadUploadHistory(),
                            loadStats()
                        ]);
                        
                        setUploadProgress(0);
                    } else {
                        throw new Error(response.error || 'Upload failed');
                    }
                } catch (error) {
                    console.error('Upload failed:', error);
                    setError(api.handleError(error, 'File upload'));
                    setUploadProgress(0);
                } finally {
                    setLoading(false);
                }
            };

            const runReconciliation = async () => {
                if (selectedUploadIds.length < 2) {
                    setError('Please select at least 2 files for reconciliation');
                    return;
                }

                if (!api) {
                    setError('API service not available');
                    return;
                }

                setLoading(true);
                setError(null);
                setReconciliationResults(null);

                try {
                    console.log('Running production reconciliation with uploads:', selectedUploadIds);
                    console.log('Settings:', reconciliationSettings);

                    const response = await api.runReconciliation(selectedUploadIds, reconciliationSettings);

                    if (response.success) {
                        console.log('Production reconciliation successful:', response);
                        setReconciliationResults(response);
                        showNotification(`Reconciliation complete: ${response.summary.totalMatches} matches found with ${response.summary.matchRate}% success rate`, 'success');
                        
                        setActiveTab('reconciliation');
                        await loadStats();
                    } else {
                        throw new Error(response.error || 'Reconciliation failed');
                    }
                } catch (error) {
                    console.error('Reconciliation failed:', error);
                    setError(api.handleError(error, 'Reconciliation'));
                } finally {
                    setLoading(false);
                }
            };

            const generateReport = async (reportType) => {
                if (!reconciliationResults) {
                    setError('Please run a reconciliation first to generate reports');
                    return;
                }

                setGeneratingReport(true);
                console.log(`Generating ${reportType} report...`);

                try {
                    const summary = reconciliationResults.summary;
                    const businessMetrics = calculateBusinessMetrics(summary);

                    if (reportType === 'executive-summary') {
                        await generateExecutiveSummaryPDF(summary, businessMetrics);
                    } else if (reportType === 'detailed-analysis') {
                        await generateDetailedAnalysisExcel(reconciliationResults, businessMetrics);
                    }

                    const newReport = {
                        id: Date.now(),
                        type: reportType === 'executive-summary' ? 'Executive Summary' : 'Detailed Analysis',
                        createdAt: new Date().toISOString(),
                        matches: summary.totalMatches,
                        matchRate: summary.matchRate,
                        timeSaved: businessMetrics.timeSavedHours
                    };
                    setReportHistory(prev => [newReport, ...prev]);

                    showNotification(`${newReport.type} generated successfully`, 'success');

                } catch (error) {
                    console.error('Failed to generate report:', error);
                    setError('Failed to generate report. Please try again.');
                } finally {
                    setGeneratingReport(false);
                }
            };

            const calculateBusinessMetrics = (summary) => {
                const totalRecords = summary.totalRecords || 0;
                const totalMatches = summary.totalMatches || 0;
                const matchRate = summary.matchRate || 0;

                const avgTimePerManualMatch = 15; // minutes
                const timeSavedHours = Math.round((totalMatches * avgTimePerManualMatch) / 60 * 100) / 100;
                const hourlyRate = 25; // USD per hour
                const costSavings = Math.round(timeSavedHours * hourlyRate);
                const avgRevenuePerMatch = 45; // Average revenue recovered per match
                const revenueRecovery = Math.round(totalMatches * avgRevenuePerMatch);
                const roi = costSavings > 0 ? Math.round(((revenueRecovery + costSavings) / 299) * 100) : 0;

                return {
                    timeSavedHours,
                    costSavings,
                    revenueRecovery,
                    roi,
                    efficiencyGain: Math.round((matchRate / 100) * 96),
                    processingSpeed: totalRecords > 0 ? Math.round(totalRecords / 0.5) + ' records/minute' : '0 records/minute'
                };
            };

            const generateExecutiveSummaryPDF = async (summary, metrics) => {
                const reportContent = `
                    <div class="print-only" style="max-width: 800px; margin: 0 auto; padding: 40px; font-family: Arial, sans-serif;">
                        <div style="text-align: center; margin-bottom: 40px;">
                            <h1 style="color: #1E40AF; margin-bottom: 10px;">MedSpaSync Pro</h1>
                            <h2 style="color: #374151; margin-bottom: 5px;">Executive Reconciliation Summary</h2>
                            <p style="color: #6B7280; margin: 0;">Generated on ${new Date().toLocaleDateString()}</p>
                        </div>

                        <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 30px; margin-bottom: 40px;">
                            <div style="background: #F3F4F6; padding: 20px; border-radius: 8px;">
                                <h3 style="color: #1F2937; margin-bottom: 15px;">Reconciliation Results</h3>
                                <p><strong>Total Matches:</strong> ${summary.totalMatches}</p>
                                <p><strong>Match Rate:</strong> ${summary.matchRate}%</p>
                                <p><strong>Total Records:</strong> ${summary.totalRecords}</p>
                                <p><strong>Exact Matches:</strong> ${summary.exactMatches}</p>
                                <p><strong>Fuzzy Matches:</strong> ${summary.fuzzyMatches}</p>
                            </div>
                            
                            <div style="background: #ECFDF5; padding: 20px; border-radius: 8px;">
                                <h3 style="color: #1F2937; margin-bottom: 15px;">Business Impact</h3>
                                <p><strong>Time Saved:</strong> ${metrics.timeSavedHours} hours</p>
                                <p><strong>Cost Savings:</strong> $${metrics.costSavings}</p>
                                <p><strong>Revenue Recovery:</strong> $${metrics.revenueRecovery}</p>
                                <p><strong>ROI:</strong> ${metrics.roi}%</p>
                                <p><strong>Efficiency Gain:</strong> ${metrics.efficiencyGain}%</p>
                            </div>
                        </div>

                        <div style="margin-bottom: 30px;">
                            <h3 style="color: #1F2937; margin-bottom: 15px;">Key Performance Indicators</h3>
                            <div style="background: white; border: 1px solid #E5E7EB; padding: 20px; border-radius: 8px;">
                                <p>✅ <strong>Processing Speed:</strong> ${metrics.processingSpeed}</p>
                                <p>✅ <strong>Accuracy Rate:</strong> ${summary.matchRate}% automated matching</p>
                                <p>✅ <strong>Time Reduction:</strong> ${metrics.efficiencyGain}% faster than manual processing</p>
                                <p>✅ <strong>Quality Assurance:</strong> ${summary.exactMatches} perfect matches with 100% confidence</p>
                            </div>
                        </div>

                        <div style="text-align: center; margin-top: 40px; padding-top: 20px; border-top: 1px solid #E5E7EB;">
                            <p style="color: #6B7280; margin: 0;">MedSpaSync Pro - Automated Reconciliation Platform</p>
                            <p style="color: #6B7280; margin: 0;">Contact: sales@mythosmedia.co</p>
                        </div>
                    </div>
                `;

                const printWindow = window.open('', '_blank');
                printWindow.document.write(`
                    <html>
                        <head>
                            <title>Executive Summary - MedSpaSync Pro</title>
                            <style>
                                body { margin: 0; padding: 0; }
                                @media print { 
                                    body { margin: 0; }
                                    .no-print { display: none; }
                                }
                            </style>
                        </head>
                        <body onload="window.print(); window.close();">
                            ${reportContent}
                        </body>
                    </html>
                `);
                printWindow.document.close();
            };

            const generateDetailedAnalysisExcel = async (results, metrics) => {
                const csvContent = generateCSVContent(results, metrics);
                
                const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
                const link = document.createElement('a');
                const url = URL.createObjectURL(blob);
                link.setAttribute('href', url);
                link.setAttribute('download', `MedSpaSync_Detailed_Analysis_${new Date().toISOString().split('T')[0]}.csv`);
                link.style.visibility = 'hidden';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            };

            const generateCSVContent = (results, metrics) => {
                let csv = 'MedSpaSync Pro - Detailed Reconciliation Analysis\n\n';
                
                csv += 'EXECUTIVE SUMMARY\n';
                csv += 'Metric,Value\n';
                csv += `Total Matches,${results.summary.totalMatches}\n`;
                csv += `Match Rate,${results.summary.matchRate}%\n`;
                csv += `Total Records,${results.summary.totalRecords}\n`;
                csv += `Exact Matches,${results.summary.exactMatches}\n`;
                csv += `Fuzzy Matches,${results.summary.fuzzyMatches}\n`;
                csv += `Time Saved,${metrics.timeSavedHours} hours\n`;
                csv += `Cost Savings,$${metrics.costSavings}\n`;
                csv += `Revenue Recovery,$${metrics.revenueRecovery}\n`;
                csv += `ROI,${metrics.roi}%\n\n`;

                if (results.matches && results.matches.length > 0) {
                    csv += 'MATCHED RECORDS\n';
                    csv += 'Match Type,Confidence,File 1,Patient 1,Amount 1,File 2,Patient 2,Amount/Points 2\n';
                    
                    results.matches.forEach(match => {
                        csv += `${match.matchType},${Math.round(match.confidence * 100)}%,`;
                        csv += `${match.record1.fileName},${match.record1.data.patientName},${match.record1.data.amount || 'N/A'},`;
                        csv += `${match.record2.fileName},${match.record2.data.patientName},${match.record2.data.points || match.record2.data.amount || 'N/A'}\n`;
                    });
                    csv += '\n';
                }

                if (results.unmatched && results.unmatched.length > 0) {
                    csv += 'UNMATCHED RECORDS\n';
                    csv += 'File Name,Patient Name,Amount,Reason\n';
                    
                    results.unmatched.forEach(item => {
                        csv += `${item.fileName},${item.record?.patientName || 'Unknown'},${item.record?.amount || 'N/A'},${item.reason}\n`;
                    });
                }

                return csv;
            };

            const handleLogout = () => {
                console.log('Logging out from production...');
                if (api) {
                    api.logout();
                }
                showNotification('Logged out successfully', 'success');
                setTimeout(() => {
                    window.location.href = 'login.html';
                }, 1000);
            };

            const showNotification = (message, type = 'success') => {
                console.log(`Notification (${type}): ${message}`);
                const notification = document.createElement('div');
                const iconHtml = type === 'success' ? '✅' : type === 'error' ? '❌' : 'ℹ️';
                notification.className = `fixed top-4 right-4 p-4 rounded-lg text-white z-50 transform transition-all duration-300 flex items-center gap-2 ${
                    type === 'success' ? 'bg-green-500' : type === 'info' ? 'bg-blue-500' : 'bg-red-500'
                }`;
                notification.innerHTML = `${iconHtml} ${message}`;
                document.body.appendChild(notification);
                
                setTimeout(() => {
                    if (document.body.contains(notification)) {
                        notification.style.transform = 'translateX(100%)';
                        setTimeout(() => {
                            if (document.body.contains(notification)) {
                                document.body.removeChild(notification);
                            }
                        }, 300);
                    }
                }, 3000);
            };

            const formatCurrency = (amount) => {
                if (api && api.formatCurrency) {
                    return api.formatCurrency(amount);
                }
                return `$${parseFloat(amount || 0).toFixed(2)}`;
            };

            const formatDate = (dateString) => {
                if (api && api.formatDate) {
                    return api.formatDate(dateString);
                }
                return new Date(dateString).toLocaleDateString();
            };

            const getFileTypeColor = (fileType) => {
                const colors = {
                    pos_transactions: 'bg-blue-100 text-blue-800',
                    alle_rewards: 'bg-green-100 text-green-800',
                    aspire_certificates: 'bg-purple-100 text-purple-800',
                    unknown: 'bg-gray-100 text-gray-800'
                };
                return colors[fileType] || 'bg-gray-100 text-gray-800';
            };

            const getFileTypeLabel = (fileType) => {
                const labels = {
                    pos_transactions: 'POS Transactions',
                    alle_rewards: 'Alle Rewards',
                    aspire_certificates: 'Aspire Certificates',
                    unknown: 'Unknown Type'
                };
                return labels[fileType] || fileType;
            };

            const handleDrag = (e) => {
                e.preventDefault();
                e.stopPropagation();
                if (e.type === "dragenter" || e.type === "dragover") {
                    setDragActive(true);
                } else if (e.type === "dragleave") {
                    setDragActive(false);
                }
            };

            const handleDrop = (e) => {
                e.preventDefault();
                e.stopPropagation();
                setDragActive(false);
                
                if (e.dataTransfer.files && e.dataTransfer.files[0]) {
                    handleFileUpload(e.dataTransfer.files);
                }
            };

            const toggleUploadSelection = (uploadId) => {
                setSelectedUploadIds(prev => {
                    if (prev.includes(uploadId)) {
                        return prev.filter(id => id !== uploadId);
                    } else {
                        return [...prev, uploadId];
                    }
                });
            };

            const handleFileInputChange = (e) => {
                if (e.target.files && e.target.files[0]) {
                    handleFileUpload(e.target.files);
                }
            };

            if (loading && !user) {
                return (
                    <div className="flex items-center justify-center min-h-screen bg-gray-50">
                        <div className="text-center">
                            <div className="relative">
                                <Server className="w-16 h-16 mx-auto text-blue-600 animate-pulse" />
                                <Zap className="w-6 h-6 absolute top-0 right-0 text-yellow-500 animate-bounce" />
                            </div>
                            <p className="mt-6 text-xl text-gray-600 flex items-center justify-center gap-2">
                                <Shield className="w-5 h-5 text-green-600" />
                                Connecting to MedSpaSync Pro...
                            </p>
                            <p className="mt-2 text-sm text-gray-500 flex items-center justify-center gap-2">
                                <Activity className="w-4 h-4 animate-pulse" />
                                Loading your reconciliation dashboard
                            </p>
                        </div>
                    </div>
                );
            }

            return (
                <div className="min-h-screen bg-gray-50">
                    {/* Enhanced Header */}
                    <header className="bg-white shadow-sm border-b no-print">
                        <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                            <div className="flex justify-between items-center h-16">
                                <div className="flex items-center space-x-4">
                                    <div className="flex items-center space-x-2">
                                        <div className="w-8 h-8 bg-gradient-to-r from-blue-500 to-purple-600 rounded-lg flex items-center justify-center">
                                            <BarChart3 className="w-5 h-5 text-white" />
                                        </div>
                                        <span className="text-xl font-bold text-gray-900">MedSpaSync Pro</span>
                                    </div>
                                    <div className="hidden md:flex items-center space-x-4">
                                        <span className="text-sm text-gray-500">|</span>
                                        <div className="flex items-center space-x-1">
                                            <Shield className="w-4 h-4 text-green-600" />
                                            <span className="text-sm text-green-600 font-medium">Production</span>
                                        </div>
                                        <div className="flex items-center space-x-1">
                                            <Activity className="w-4 h-4 text-blue-600 animate-pulse" />
                                            <span className="text-sm text-blue-600 font-medium">Live</span>
                                        </div>
                                    </div>
                                </div>
                                
                                <div className="flex items-center space-x-4">
                                    {user && (
                                        <div className="text-right">
                                            <div className="text-sm font-medium text-gray-900 flex items-center gap-1">
                                                <Users className="w-4 h-4" />
                                                {user.firstName} {user.lastName}
                                            </div>
                                            <div className="text-xs text-gray-500 flex items-center gap-1">
                                                <Briefcase className="w-3 h-3" />
                                                {user.practice.name}
                                            </div>
                                        </div>
                                    )}
                                    <button className="p-2 text-gray-400 hover:text-gray-600 transition-colors hover:bg-gray-100 rounded-lg">
                                        <Settings className="w-5 h-5" />
                                    </button>
                                    <button onClick={handleLogout} className="p-2 text-gray-400 hover:text-gray-600 transition-colors hover:bg-gray-100 rounded-lg">
                                        <LogOut className="w-5 h-5" />
                                    </button>
                                </div>
                            </div>
                        </div>
                    </header>

                    <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
                        {/* Enhanced Error Alert */}
                        {error && (
                            <div className="mb-6 bg-red-50 border border-red-200 rounded-lg p-4 no-print">
                                <div className="flex">
                                    <AlertCircle className="h-5 w-5 text-red-400" />
                                    <div className="ml-3">
                                        <h3 className="text-sm font-medium text-red-800 flex items-center gap-1">
                                            <XCircle className="w-4 h-4" />
                                            Error
                                        </h3>
                                        <p className="mt-1 text-sm text-red-700">{error}</p>
                                        <button
                                            onClick={() => setError(null)}
                                            className="mt-2 text-sm text-red-600 hover:text-red-500 underline flex items-center gap-1"
                                        >
                                            <X className="w-3 h-3" />
                                            Dismiss
                                        </button>
                                    </div>
                                </div>
                            </div>
                        )}

                        {/* Enhanced Navigation Tabs */}
                        <div className="border-b border-gray-200 mb-8 no-print">
                            <nav className="-mb-px flex space-x-8">
                                {[
                                    { id: 'dashboard', name: 'Dashboard', icon: Home },
                                    { id: 'uploads', name: 'File Uploads', icon: Upload },
                                    { id: 'reconciliation', name: 'Reconciliation', icon: Target },
                                    { id: 'reports', name: 'Reports', icon: BarChart3 }
                                ].map((tab) => {
                                    const Icon = tab.icon;
                                    return (
                                        <button
                                            key={tab.id}
                                            onClick={() => setActiveTab(tab.id)}
                                            className={`flex items-center space-x-2 py-4 px-1 border-b-2 font-medium text-sm transition-colors ${
                                                activeTab === tab.id
                                                    ? 'border-blue-500 text-blue-600'
                                                    : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'
                                            }`}
                                        >
                                            <Icon className="w-5 h-5" />
                                            <span>{tab.name}</span>
                                            {activeTab === tab.id && <ChevronRight className="w-4 h-4" />}
                                        </button>
                                    );
                                })}
                            </nav>
                        </div>

                        {/* Enhanced Dashboard Tab */}
                        {activeTab === 'dashboard' && (
                            <div className="space-y-8">
                                {/* Enhanced Key Metrics */}
                                <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                                    <div className="bg-white rounded-lg shadow p-6 metric-card">
                                        <div className="flex items-center">
                                            <div className="flex-shrink-0">
                                                <div className="p-2 bg-blue-100 rounded-lg">
                                                    <Database className="h-6 w-6 text-blue-600" />
                                                </div>
                                            </div>
                                            <div className="ml-4">
                                                <p className="text-sm font-medium text-gray-500 flex items-center gap-1">
                                                    <Hash className="w-3 h-3" />
                                                    Total Records
                                                </p>
                                                <p className="text-2xl font-semibold text-gray-900">{stats?.totalRecords || 0}</p>
                                                <p className="text-xs text-green-600 flex items-center gap-1">
                                                    <TrendingUp className="w-3 h-3" />
                                                    Processed
                                                </p>
                                            </div>
                                        </div>
                                    </div>

                                    <div className="bg-white rounded-lg shadow p-6 metric-card">
                                        <div className="flex items-center">
                                            <div className="flex-shrink-0">
                                                <div className="p-2 bg-green-100 rounded-lg">
                                                    <FolderOpen className="h-6 w-6 text-green-600" />
                                                </div>
                                            </div>
                                            <div className="ml-4">
                                                <p className="text-sm font-medium text-gray-500 flex items-center gap-1">
                                                    <FilePlus className="w-3 h-3" />
                                                    Total Uploads
                                                </p>
                                                <p className="text-2xl font-semibold text-gray-900">{stats?.totalUploads || 0}</p>
                                                <p className="text-xs text-blue-600 flex items-center gap-1">
                                                    <Clock className="w-3 h-3" />
                                                    Files ready
                                                </p>
                                            </div>
                                        </div>
                                    </div>

                                    <div className="bg-white rounded-lg shadow p-6 metric-card">
                                        <div className="flex items-center">
                                            <div className="flex-shrink-0">
                                                <div className="p-2 bg-yellow-100 rounded-lg">
                                                    <Target className="h-6 w-6 text-yellow-600" />
                                                </div>
                                            </div>
                                            <div className="ml-4">
                                                <p className="text-sm font-medium text-gray-500 flex items-center gap-1">
                                                    <CheckCircle className="w-3 h-3" />
                                                    Ready to Reconcile
                                                </p>
                                                <p className="text-2xl font-semibold text-gray-900">{selectedUploadIds.length}</p>
                                                <p className="text-xs text-purple-600 flex items-center gap-1">
                                                    <Zap className="w-3 h-3" />
                                                    Selected
                                                </p>
                                            </div>
                                        </div>
                                    </div>

                                    <div className="bg-white rounded-lg shadow p-6 metric-card">
                                        <div className="flex items-center">
                                            <div className="flex-shrink-0">
                                                <div className="p-2 bg-purple-100 rounded-lg">
                                                    <Activity className="h-6 w-6 text-purple-600" />
                                                </div>
                                            </div>
                                            <div className="ml-4">
                                                <p className="text-sm font-medium text-gray-500 flex items-center gap-1">
                                                    <Search className="w-3 h-3" />
                                                    Potential Pairs
                                                </p>
                                                <p className="text-2xl font-semibold text-gray-900">{stats?.reconciliationOpportunities?.potentialPairs || 0}</p>
                                                <p className="text-xs text-indigo-600 flex items-center gap-1">
                                                    <ArrowUp className="w-3 h-3" />
                                                    Opportunities
                                                </p>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                {/* Enhanced Quick Actions */}
                                <div className="bg-white rounded-lg shadow p-6">
                                    <h3 className="text-lg font-medium text-gray-900 mb-4 flex items-center gap-2">
                                        <Zap className="w-5 h-5 text-yellow-500" />
                                        Quick Actions
                                    </h3>
                                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                        <button
                                            onClick={() => setActiveTab('uploads')}
                                            className="action-button flex items-center justify-center px-4 py-3 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors"
                                        >
                                            <FilePlus className="w-5 h-5 mr-2 text-blue-600" />
                                            Upload New Files
                                            <ArrowRight className="w-4 h-4 ml-2 text-gray-400" />
                                        </button>
                                        <button
                                            onClick={runReconciliation}
                                            disabled={selectedUploadIds.length < 2 || loading}
                                            className="action-button flex items-center justify-center px-4 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors"
                                        >
                                            {loading ? (
                                                <RefreshCw className="w-5 h-5 mr-2 animate-spin" />
                                            ) : (
                                                <Play className="w-5 h-5 mr-2" />
                                            )}
                                            Run Reconciliation
                                            {!loading && <Zap className="w-4 h-4 ml-2" />}
                                        </button>
                                    </div>
                                </div>

                                {/* Enhanced Recent Uploads */}
                                <div className="bg-white rounded-lg shadow">
                                    <div className="px-6 py-4 border-b border-gray-200">
                                        <h3 className="text-lg font-medium text-gray-900 flex items-center gap-2">
                                            <FolderOpen className="w-5 h-5 text-blue-600" />
                                            Recent Uploads
                                        </h3>
                                    </div>
                                    <div className="p-6">
                                        {uploads.length === 0 ? (
                                            <div className="text-center py-8">
                                                <div className="flex justify-center mb-4">
                                                    <div className="relative">
                                                        <Upload className="w-12 h-12 text-gray-400" />
                                                        <Plus className="w-6 h-6 absolute -top-2 -right-2 text-blue-500 bg-white rounded-full border-2 border-blue-500" />
                                                    </div>
                                                </div>
                                                <p className="mt-2 text-sm text-gray-500 flex items-center justify-center gap-1">
                                                    <Info className="w-4 h-4" />
                                                    No files uploaded yet
                                                </p>
                                                <button
                                                    onClick={() => setActiveTab('uploads')}
                                                    className="mt-2 text-blue-600 hover:text-blue-500 text-sm flex items-center justify-center gap-1"
                                                >
                                                    <FilePlus className="w-4 h-4" />
                                                    Upload your first file
                                                </button>
                                            </div>
                                        ) : (
                                            <div className="space-y-4">
                                                {uploads.slice(0, 5).map((upload) => {
                                                    const fileIcon = getFileTypeIcon(upload.fileType);
                                                    const statusIcon = getStatusIcon(upload.status);
                                                    const StatusIcon = statusIcon.icon;
                                                    const FileIcon = fileIcon.icon;
                                                    
                                                    return (
                                                        <div key={upload.id} className="flex items-center justify-between p-3 border rounded-lg hover:bg-gray-50 transition-colors">
                                                            <div className="flex items-center space-x-3">
                                                                <div className={`file-type-icon ${fileIcon.color} ${fileIcon.textColor}`}>
                                                                    <FileIcon className="w-4 h-4" />
                                                                </div>
                                                                <div>
                                                                    <p className="text-sm font-medium text-gray-900 flex items-center gap-1">
                                                                        {upload.fileName}
                                                                        <Eye className="w-3 h-3 text-gray-400" />
                                                                    </p>
                                                                    <p className="text-xs text-gray-500 flex items-center gap-1">
                                                                        <Hash className="w-3 h-3" />
                                                                        {upload.recordCount} records
                                                                    </p>
                                                                </div>
                                                            </div>
                                                            <div className="flex items-center space-x-3">
                                                                <span className={`px-2 py-1 text-xs font-medium rounded-full ${getFileTypeColor(upload.fileType)} flex items-center gap-1`}>
                                                                    <StatusIcon className={`w-3 h-3 ${statusIcon.color}`} />
                                                                    {getFileTypeLabel(upload.fileType)}
                                                                </span>
                                                                <span className="text-xs text-gray-500 flex items-center gap-1">
                                                                    <Calendar className="w-3 h-3" />
                                                                    {formatDate(upload.createdAt)}
                                                                </span>
                                                            </div>
                                                        </div>
                                                    );
                                                })}
                                            </div>
                                        )}
                                    </div>
                                </div>
                            </div>
                        )}

                        {/* Enhanced File Uploads Tab */}
                        {activeTab === 'uploads' && (
                            <div className="space-y-8">
                                {/* Enhanced Upload Zone */}
                                <div className="bg-white rounded-lg shadow p-6">
                                    <h3 className="text-lg font-medium text-gray-900 mb-4 flex items-center gap-2">
                                        <Upload className="w-5 h-5 text-blue-600" />
                                        Upload Files
                                        <span className="text-sm text-gray-500 bg-gray-100 px-2 py-1 rounded-full flex items-center gap-1">
                                            <Shield className="w-3 h-3" />
                                            Secure
                                        </span>
                                    </h3>
                                    
                                    {/* Enhanced Upload Progress */}
                                    {uploadProgress > 0 && uploadProgress < 100 && (
                                        <div className="mb-4 p-4 bg-blue-50 rounded-lg border border-blue-200">
                                            <div className="flex justify-between items-center mb-2">
                                                <span className="text-sm text-blue-700 flex items-center gap-1">
                                                    <RefreshCw className="w-4 h-4 animate-spin" />
                                                    Uploading...
                                                </span>
                                                <span className="text-sm text-blue-700 font-semibold">{uploadProgress}%</span>
                                            </div>
                                            <div className="w-full bg-blue-200 rounded-full h-3">
                                                <div
                                                    className="bg-blue-600 h-3 rounded-full transition-all duration-300 flex items-center justify-end pr-2"
                                                    style={{ width: `${uploadProgress}%` }}
                                                >
                                                    {uploadProgress > 20 && <Zap className="w-3 h-3 text-white" />}
                                                </div>
                                            </div>
                                        </div>
                                    )}

                                    <div
                                        className={`border-2 border-dashed rounded-lg p-8 text-center transition-all duration-300 ${
                                            dragActive ? 'border-blue-500 bg-blue-50 transform scale-105' : 'border-gray-300'
                                        }`}
                                        onDragEnter={handleDrag}
                                        onDragLeave={handleDrag}
                                        onDragOver={handleDrag}
                                        onDrop={handleDrop}
                                    >
                                        <div className="flex justify-center mb-4">
                                            <div className="relative">
                                                <Upload className={`h-12 w-12 ${dragActive ? 'text-blue-500 animate-bounce' : 'text-gray-400'}`} />
                                                {dragActive && <Zap className="w-6 h-6 absolute -top-2 -right-2 text-yellow-500 animate-pulse" />}
                                            </div>
                                        </div>
                                        <h4 className="mt-4 text-lg font-medium text-gray-900 flex items-center justify-center gap-2">
                                            Drop files here or click to upload
                                            {dragActive && <Target className="w-5 h-5 text-blue-500" />}
                                        </h4>
                                        <p className="mt-2 text-sm text-gray-500 flex items-center justify-center gap-1">
                                            <FileCheck className="w-4 h-4" />
                                            Supports CSV and Excel files (POS transactions, Alle rewards, Aspire certificates)
                                        </p>
                                        <div className="mt-4 flex items-center justify-center gap-4 text-xs text-gray-400">
                                            <div className="flex items-center gap-1">
                                                <Database className="w-3 h-3" />
                                                POS Data
                                            </div>
                                            <div className="flex items-center gap-1">
                                                <Award className="w-3 h-3" />
                                                Alle Rewards
                                            </div>
                                            <div className="flex items-center gap-1">
                                                <Star className="w-3 h-3" />
                                                Aspire Certs
                                            </div>
                                        </div>
                                        <input
                                            ref={fileInputRef}
                                            type="file"
                                            accept=".csv,.xlsx,.xls"
                                            onChange={handleFileInputChange}
                                            disabled={loading}
                                            className="hidden"
                                        />
                                        <button
                                            onClick={() => fileInputRef.current?.click()}
                                            disabled={loading}
                                            className="mt-4 inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-blue-600 bg-blue-100 hover:bg-blue-200 disabled:opacity-50 disabled:cursor-not-allowed transition-colors"
                                        >
                                            <FilePlus className="w-4 h-4 mr-2" />
                                            Choose File
                                            <ArrowRight className="w-4 h-4 ml-2" />
                                        </button>
                                    </div>
                                </div>

                                {/* Enhanced Upload History with Selection */}
                                <div className="bg-white rounded-lg shadow">
                                    <div className="px-6 py-4 border-b border-gray-200">
                                        <div className="flex justify-between items-center">
                                            <h3 className="text-lg font-medium text-gray-900 flex items-center gap-2">
                                                <Layers className="w-5 h-5 text-blue-600" />
                                                Upload History
                                            </h3>
                                            <div className="flex items-center gap-2">
                                                <span className="text-sm text-gray-500 flex items-center gap-1">
                                                    <CheckCircle className="w-4 h-4 text-green-600" />
                                                    {selectedUploadIds.length} selected for reconciliation
                                                </span>
                                                {selectedUploadIds.length >= 2 && (
                                                    <span className="text-xs bg-green-100 text-green-800 px-2 py-1 rounded-full flex items-center gap-1">
                                                        <Zap className="w-3 h-3" />
                                                        Ready
                                                    </span>
                                                )}
                                            </div>
                                        </div>
                                    </div>
                                    <div className="overflow-x-auto">
                                        <table className="min-w-full divide-y divide-gray-200">
                                            <thead className="bg-gray-50">
                                                <tr>
                                                    <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                                        <div className="flex items-center gap-1">
                                                            <CheckCircle className="w-3 h-3" />
                                                            Select
                                                        </div>
                                                    </th>
                                                    <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                                        <div className="flex items-center gap-1">
                                                            <FileText className="w-3 h-3" />
                                                            File Name
                                                        </div>
                                                    </th>
                                                    <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                                        <div className="flex items-center gap-1">
                                                            <Filter className="w-3 h-3" />
                                                            Type
                                                        </div>
                                                    </th>
                                                    <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                                        <div className="flex items-center gap-1">
                                                            <Hash className="w-3 h-3" />
                                                            Records
                                                        </div>
                                                    </th>
                                                    <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                                        <div className="flex items-center gap-1">
                                                            <Activity className="w-3 h-3" />
                                                            Status
                                                        </div>
                                                    </th>
                                                    <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                                        <div className="flex items-center gap-1">
                                                            <Calendar className="w-3 h-3" />
                                                            Uploaded
                                                        </div>
                                                    </th>
                                                </tr>
                                            </thead>
                                            <tbody className="bg-white divide-y divide-gray-200">
                                                {uploads.map((upload) => {
                                                    const fileIcon = getFileTypeIcon(upload.fileType);
                                                    const statusIcon = getStatusIcon(upload.status);
                                                    const StatusIcon = statusIcon.icon;
                                                    const FileIcon = fileIcon.icon;
                                                    const isSelected = selectedUploadIds.includes(upload.id);
                                                    
                                                    return (
                                                        <tr key={upload.id} className={`hover:bg-gray-50 transition-colors ${isSelected ? 'bg-blue-50' : ''}`}>
                                                            <td className="px-6 py-4 whitespace-nowrap">
                                                                <input
                                                                    type="checkbox"
                                                                    checked={isSelected}
                                                                    onChange={() => toggleUploadSelection(upload.id)}
                                                                    className="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"
                                                                />
                                                            </td>
                                                            <td className="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">
                                                                <div className="flex items-center gap-2">
                                                                    <div className={`file-type-icon ${fileIcon.color} ${fileIcon.textColor}`}>
                                                                        <FileIcon className="w-3 h-3" />
                                                                    </div>
                                                                    {upload.fileName}
                                                                </div>
                                                            </td>
                                                            <td className="px-6 py-4 whitespace-nowrap">
                                                                <span className={`px-2 py-1 text-xs font-medium rounded-full ${getFileTypeColor(upload.fileType)} flex items-center gap-1 w-fit`}>
                                                                    <FileIcon className="w-3 h-3" />
                                                                    {getFileTypeLabel(upload.fileType)}
                                                                </span>
                                                            </td>
                                                            <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                                                                <div className="flex items-center gap-1">
                                                                    <Hash className="w-3 h-3 text-gray-400" />
                                                                    {upload.recordCount}
                                                                </div>
                                                            </td>
                                                            <td className="px-6 py-4 whitespace-nowrap">
                                                                <span className={`status-badge px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800`}>
                                                                    <StatusIcon className={`w-3 h-3 ${statusIcon.color}`} />
                                                                    {upload.status}
                                                                </span>
                                                            </td>
                                                            <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                                                                <div className="flex items-center gap-1">
                                                                    <Calendar className="w-3 h-3" />
                                                                    {formatDate(upload.createdAt)}
                                                                </div>
                                                            </td>
                                                        </tr>
                                                    );
                                                })}
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        )}

                        {/* Enhanced Reconciliation Tab */}
                        {activeTab === 'reconciliation' && (
                            <div className="space-y-8">
                                {/* Enhanced Reconciliation Controls */}
                                <div className="bg-white rounded-lg shadow p-6">
                                    <div className="flex items-center justify-between mb-6">
                                        <h3 className="text-lg font-medium text-gray-900 flex items-center gap-2">
                                            <Target className="w-5 h-5 text-blue-600" />
                                            Reconciliation Analysis
                                            <span className="text-sm bg-blue-100 text-blue-800 px-2 py-1 rounded-full flex items-center gap-1">
                                                <Cpu className="w-3 h-3" />
                                                AI-Powered
                                            </span>
                                        </h3>
                                        <button
                                            onClick={runReconciliation}
                                            disabled={loading || selectedUploadIds.length < 2}
                                            className="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-blue-600 hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-all"
                                        >
                                            {loading ? (
                                                <RefreshCw className="w-4 h-4 mr-2 animate-spin" />
                                            ) : (
                                                <Play className="w-4 h-4 mr-2" />
                                            )}
                                            {loading ? 'Analyzing...' : 'Start Reconciliation'}
                                            {!loading && <Zap className="w-4 h-4 ml-2" />}
                                        </button>
                                    </div>

                                    {/* Enhanced Reconciliation Settings */}
                                    <div className="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6 p-4 bg-gray-50 rounded-lg">
                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-1 flex items-center gap-1">
                                                <Target className="w-3 h-3" />
                                                Match Criteria
                                            </label>
                                            <select
                                                value={reconciliationSettings.matchCriteria}
                                                onChange={(e) => setReconciliationSettings({...reconciliationSettings, matchCriteria: e.target.value})}
                                                className="block w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-blue-500 focus:border-blue-500"
                                            >
                                                <option value="strict">🎯 Strict (90%+ confidence)</option>
                                                <option value="normal">⚡ Normal (70%+ confidence)</option>
                                                <option value="fuzzy">🔍 Fuzzy (50%+ confidence)</option>
                                            </select>
                                        </div>
                                        
                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-1 flex items-center gap-1">
                                                <Calendar className="w-3 h-3" />
                                                Date Tolerance (days)
                                            </label>
                                            <input
                                                type="number"
                                                min="0"
                                                max="30"
                                                value={reconciliationSettings.dateToleranceDays}
                                                onChange={(e) => setReconciliationSettings({...reconciliationSettings, dateToleranceDays: parseInt(e.target.value)})}
                                                className="block w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-blue-500 focus:border-blue-500"
                                            />
                                        </div>
                                        
                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-1 flex items-center gap-1">
                                                <Percent className="w-3 h-3" />
                                                Amount Tolerance (%)
                                            </label>
                                            <input
                                                type="number"
                                                min="0"
                                                max="50"
                                                value={reconciliationSettings.amountTolerancePercent}
                                                onChange={(e) => setReconciliationSettings({...reconciliationSettings, amountTolerancePercent: parseInt(e.target.value)})}
                                                className="block w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-blue-500 focus:border-blue-500"
                                            />
                                        </div>
                                    </div>

                                    <div className="text-sm text-gray-600 mb-4 p-3 bg-blue-50 rounded-lg flex items-center gap-2">
                                        <Info className="w-4 h-4 text-blue-600" />
                                        Selected {selectedUploadIds.length} files for reconciliation. 
                                        {selectedUploadIds.length < 2 && (
                                            <span className="text-yellow-600 ml-1 flex items-center gap-1">
                                                <AlertTriangle className="w-4 h-4" />
                                                (Select at least 2 files from the Uploads tab)
                                            </span>
                                        )}
                                        {selectedUploadIds.length >= 2 && (
                                            <span className="text-green-600 ml-1 flex items-center gap-1">
                                                <CheckCircle className="w-4 h-4" />
                                                Ready to analyze!
                                            </span>
                                        )}
                                    </div>

                                    {loading && (
                                        <div className="text-center py-8 bg-blue-50 rounded-lg">
                                            <div className="flex justify-center mb-4">
                                                <div className="relative">
                                                    <Cpu className="w-8 h-8 text-blue-600 animate-pulse" />
                                                    <Activity className="w-4 h-4 absolute -top-1 -right-1 text-green-500 animate-bounce" />
                                                </div>
                                            </div>
                                            <p className="mt-2 text-sm text-blue-700 font-medium flex items-center justify-center gap-1">
                                                <Zap className="w-4 h-4 animate-pulse" />
                                                Running advanced reconciliation algorithms...
                                            </p>
                                            <p className="text-xs text-blue-600 mt-1">AI matching in progress</p>
                                        </div>
                                    )}
                                </div>

                                {/* Enhanced Reconciliation Results */}
                                {reconciliationResults && (
                                    <div className="space-y-6">
                                        {/* Enhanced Summary Cards */}
                                        <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
                                            <div className="bg-white rounded-lg shadow p-6 metric-card">
                                                <div className="flex items-center">
                                                    <div className="p-2 bg-green-100 rounded-lg">
                                                        <CheckCircle className="h-6 w-6 text-green-600" />
                                                    </div>
                                                    <div className="ml-4">
                                                        <p className="text-sm font-medium text-gray-500 flex items-center gap-1">
                                                            <Target className="w-3 h-3" />
                                                            Total Matches
                                                        </p>
                                                        <p className="text-2xl font-semibold text-gray-900">
                                                            {reconciliationResults.summary.totalMatches}
                                                        </p>
                                                        <p className="text-xs text-gray-500 flex items-center gap-1">
                                                            <Award className="w-3 h-3 text-green-600" />
                                                            {reconciliationResults.summary.exactMatches} exact, {reconciliationResults.summary.fuzzyMatches} fuzzy
                                                        </p>
                                                    </div>
                                                </div>
                                            </div>

                                            <div className="bg-white rounded-lg shadow p-6 metric-card">
                                                <div className="flex items-center">
                                                    <div className="p-2 bg-blue-100 rounded-lg">
                                                        <TrendingUp className="h-6 w-6 text-blue-600" />
                                                    </div>
                                                    <div className="ml-4">
                                                        <p className="text-sm font-medium text-gray-500 flex items-center gap-1">
                                                            <Percent className="w-3 h-3" />
                                                            Match Rate
                                                        </p>
                                                        <p className="text-2xl font-semibold text-gray-900">
                                                            {reconciliationResults.summary.matchRate}%
                                                        </p>
                                                        <p className="text-xs text-gray-500 flex items-center gap-1">
                                                            <Database className="w-3 h-3 text-blue-600" />
                                                            {reconciliationResults.summary.totalRecords} total records
                                                        </p>
                                                    </div>
                                                </div>
                                            </div>

                                            <div className="bg-white rounded-lg shadow p-6 metric-card">
                                                <div className="flex items-center">
                                                    <div className="p-2 bg-purple-100 rounded-lg">
                                                        <Clock className="h-6 w-6 text-purple-600" />
                                                    </div>
                                                    <div className="ml-4">
                                                        <p className="text-sm font-medium text-gray-500 flex items-center gap-1">
                                                            <Zap className="w-3 h-3" />
                                                            Time Saved
                                                        </p>
                                                        <p className="text-2xl font-semibold text-gray-900">
                                                            {reconciliationResults.summary.timeSaved?.timeSavedHours || 0}h
                                                        </p>
                                                        <p className="text-xs text-gray-500 flex items-center gap-1">
                                                            <ArrowUp className="w-3 h-3 text-purple-600" />
                                                            vs manual reconciliation
                                                        </p>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        {/* Enhanced Production Results */}
                                        <div className="bg-green-50 border border-green-200 rounded-lg p-4">
                                            <div className="flex">
                                                <CheckCircle className="h-5 w-5 text-green-400" />
                                                <div className="ml-3">
                                                    <h3 className="text-sm font-medium text-green-800 flex items-center gap-1">
                                                        <Shield className="w-4 h-4" />
                                                        Production Reconciliation Complete
                                                    </h3>
                                                    <p className="mt-1 text-sm text-green-700 flex items-center gap-1">
                                                        <Cpu className="w-4 h-4" />
                                                        Real reconciliation completed successfully using your advanced algorithms. 
                                                        Results show actual matches from your uploaded files.
                                                    </p>
                                                </div>
                                            </div>
                                        </div>

                                        {/* Enhanced Matches Display */}
                                        {reconciliationResults.matches && reconciliationResults.matches.length > 0 && (
                                            <div className="bg-white rounded-lg shadow">
                                                <div className="px-6 py-4 border-b border-gray-200">
                                                    <h3 className="text-lg font-medium text-gray-900 flex items-center gap-2">
                                                        <CheckCircle2 className="w-5 h-5 text-green-600" />
                                                        Matched Records
                                                        <span className="text-sm bg-green-100 text-green-800 px-2 py-1 rounded-full">
                                                            {reconciliationResults.matches.length} found
                                                        </span>
                                                    </h3>
                                                </div>
                                                <div className="p-6">
                                                    <div className="space-y-4">
                                                        {reconciliationResults.matches.map((match) => (
                                                            <div key={match.id} className="border rounded-lg p-4 hover:bg-gray-50 transition-colors">
                                                                <div className="flex items-center justify-between mb-3">
                                                                    <span className={`px-2 py-1 text-xs font-medium rounded-full flex items-center gap-1 ${
                                                                        match.matchType === 'exact' ? 'bg-green-100 text-green-800' : 'bg-yellow-100 text-yellow-800'
                                                                    }`}>
                                                                        {match.matchType === 'exact' ? <CheckCircle className="w-3 h-3" /> : <Search className="w-3 h-3" />}
                                                                        {match.matchType} match ({Math.round(match.confidence * 100)}% confidence)
                                                                    </span>
                                                                </div>
                                                                <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                                                    <div className="p-3 bg-blue-50 rounded-lg">
                                                                        <p className="text-sm font-medium text-gray-900 flex items-center gap-1">
                                                                            <FileText className="w-4 h-4 text-blue-600" />
                                                                            {match.record1.fileName}
                                                                        </p>
                                                                        <p className="text-sm text-gray-600 flex items-center gap-1 mt-1">
                                                                            <Users className="w-3 h-3" />
                                                                            {match.record1.data.patientName} - {formatCurrency(parseFloat(match.record1.data.amount || 0))} - {match.record1.data.service}
                                                                        </p>
                                                                    </div>
                                                                    <div className="p-3 bg-green-50 rounded-lg">
                                                                        <p className="text-sm font-medium text-gray-900 flex items-center gap-1">
                                                                            <FileText className="w-4 h-4 text-green-600" />
                                                                            {match.record2.fileName}
                                                                        </p>
                                                                        <p className="text-sm text-gray-600 flex items-center gap-1 mt-1">
                                                                            <Award className="w-3 h-3" />
                                                                            {match.record2.data.patientName} - {match.record2.data.points} points - {match.record2.data.rewardType}
                                                                        </p>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        ))}
                                                    </div>
                                                </div>
                                            </div>
                                        )}

                                        {/* Enhanced Unmatched Records */}
                                        {reconciliationResults.unmatched && reconciliationResults.unmatched.length > 0 && (
                                            <div className="bg-white rounded-lg shadow">
                                                <div className="px-6 py-4 border-b border-gray-200">
                                                    <h3 className="text-lg font-medium text-gray-900 flex items-center gap-2">
                                                        <AlertTriangle className="w-5 h-5 text-yellow-600" />
                                                        Unmatched Records
                                                        <span className="text-sm bg-yellow-100 text-yellow-800 px-2 py-1 rounded-full">
                                                            {reconciliationResults.unmatched.length} items
                                                        </span>
                                                    </h3>
                                                </div>
                                                <div className="p-6">
                                                    <div className="space-y-3">
                                                        {reconciliationResults.unmatched.map((item, index) => (
                                                            <div key={index} className="flex items-center justify-between p-3 bg-yellow-50 rounded-lg border border-yellow-200">
                                                                <div className="flex items-center gap-3">
                                                                    <AlertTriangle className="w-4 h-4 text-yellow-600" />
                                                                    <div>
                                                                        <p className="text-sm font-medium text-gray-900 flex items-center gap-1">
                                                                            <Users className="w-3 h-3" />
                                                                            {item.record?.patientName || 'Unknown'} - {formatCurrency(parseFloat(item.record?.amount || 0))}
                                                                        </p>
                                                                        <p className="text-xs text-gray-500 flex items-center gap-1">
                                                                            <FileText className="w-3 h-3" />
                                                                            {item.fileName}
                                                                        </p>
                                                                    </div>
                                                                </div>
                                                                <span className="text-xs text-yellow-600 bg-yellow-200 px-2 py-1 rounded-full flex items-center gap-1">
                                                                    <Info className="w-3 h-3" />
                                                                    {item.reason}
                                                                </span>
                                                            </div>
                                                        ))}
                                                    </div>
                                                </div>
                                            </div>
                                        )}
                                    </div>
                                )}
                            </div>
                        )}

                        {/* ✅ SUPER ENHANCED REPORTS TAB WITH COMPREHENSIVE ICONS */}
                        {activeTab === 'reports' && (
                            <div className="space-y-8">
                                {/* Enhanced Report Generation Section */}
                                <div className="bg-white rounded-lg shadow p-6">
                                    <h3 className="text-lg font-medium text-gray-900 mb-6 flex items-center gap-2">
                                        <BarChart3 className="w-5 h-5 text-blue-600" />
                                        Export Reports
                                        <span className="text-sm bg-blue-100 text-blue-800 px-2 py-1 rounded-full flex items-center gap-1">
                                            <Award className="w-3 h-3" />
                                            Enterprise
                                        </span>
                                    </h3>
                                    
                                    {reconciliationResults ? (
                                        <div>
                                            {/* Enhanced Business Intelligence Overview */}
                                            <div className="mb-8 p-6 bg-gradient-to-r from-blue-50 to-indigo-50 rounded-lg border border-blue-200">
                                                <h4 className="text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2">
                                                    <TrendingUp className="w-5 h-5 text-blue-600" />
                                                    Business Intelligence Summary
                                                    <Zap className="w-4 h-4 text-yellow-500 animate-pulse" />
                                                </h4>
                                                <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                                                    <div className="text-center bg-white p-4 rounded-lg shadow-sm">
                                                        <div className="flex items-center justify-center mb-2">
                                                            <div className="p-2 bg-blue-100 rounded-full">
                                                                <Target className="w-6 h-6 text-blue-600" />
                                                            </div>
                                                        </div>
                                                        <p className="text-3xl font-bold text-blue-600">{reconciliationResults.summary.totalMatches}</p>
                                                        <p className="text-sm text-gray-600 flex items-center justify-center gap-1">
                                                            <CheckCircle className="w-3 h-3" />
                                                            Matches Found
                                                        </p>
                                                    </div>
                                                    <div className="text-center bg-white p-4 rounded-lg shadow-sm">
                                                        <div className="flex items-center justify-center mb-2">
                                                            <div className="p-2 bg-green-100 rounded-full">
                                                                <Percent className="w-6 h-6 text-green-600" />
                                                            </div>
                                                        </div>
                                                        <p className="text-3xl font-bold text-green-600">{reconciliationResults.summary.matchRate}%</p>
                                                        <p className="text-sm text-gray-600 flex items-center justify-center gap-1">
                                                            <TrendingUp className="w-3 h-3" />
                                                            Success Rate
                                                        </p>
                                                    </div>
                                                    <div className="text-center bg-white p-4 rounded-lg shadow-sm">
                                                        <div className="flex items-center justify-center mb-2">
                                                            <div className="p-2 bg-purple-100 rounded-full">
                                                                <Clock className="w-6 h-6 text-purple-600" />
                                                            </div>
                                                        </div>
                                                        <p className="text-3xl font-bold text-purple-600">{calculateBusinessMetrics(reconciliationResults.summary).timeSavedHours}h</p>
                                                        <p className="text-sm text-gray-600 flex items-center justify-center gap-1">
                                                            <Zap className="w-3 h-3" />
                                                            Time Saved
                                                        </p>
                                                    </div>
                                                </div>
                                            </div>

                                            {/* Enhanced Report Generation Cards */}
                                            <div className="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
                                                <div className="report-card border rounded-lg p-6 cursor-pointer hover:shadow-lg" onClick={() => generateReport('executive-summary')}>
                                                    <div className="flex items-center mb-4">
                                                        <div className="p-3 bg-blue-100 rounded-lg mr-4">
                                                            <div className="relative">
                                                                <FileText className="w-8 h-8 text-blue-600" />
                                                                <Award className="w-4 h-4 absolute -top-1 -right-1 text-yellow-500" />
                                                            </div>
                                                        </div>
                                                        <div>
                                                            <h4 className="text-lg font-semibold text-gray-900 flex items-center gap-2">
                                                                Executive Summary
                                                                <Star className="w-4 h-4 text-yellow-500" />
                                                            </h4>
                                                            <p className="text-sm text-gray-500 flex items-center gap-1">
                                                                <Briefcase className="w-3 h-3" />
                                                                Professional PDF report for management
                                                            </p>
                                                        </div>
                                                    </div>
                                                    <div className="space-y-3 mb-4">
                                                        <p className="text-sm text-gray-600 flex items-center gap-2">
                                                            <BarChart className="w-4 h-4 text-blue-500" />
                                                            High-level overview with {reconciliationResults.summary.totalMatches} matches 
                                                            and {reconciliationResults.summary.matchRate}% success rate
                                                        </p>
                                                        <p className="text-sm text-gray-600 flex items-center gap-2">
                                                            <DollarSign className="w-4 h-4 text-green-500" />
                                                            ROI analysis showing ${calculateBusinessMetrics(reconciliationResults.summary).revenueRecovery} potential recovery
                                                        </p>
                                                        <p className="text-sm text-gray-600 flex items-center gap-2">
                                                            <Clock className="w-4 h-4 text-purple-500" />
                                                            Time savings: {calculateBusinessMetrics(reconciliationResults.summary).timeSavedHours} hours vs manual processing
                                                        </p>
                                                    </div>
                                                    <button 
                                                        disabled={generatingReport}
                                                        className="w-full inline-flex items-center justify-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 disabled:opacity-50 transition-all"
                                                    >
                                                        {generatingReport ? (
                                                            <RefreshCw className="w-4 h-4 mr-2 animate-spin" />
                                                        ) : (
                                                            <Download className="w-4 h-4 mr-2" />
                                                        )}
                                                        Generate PDF Report
                                                        <ArrowRight className="w-4 h-4 ml-2" />
                                                    </button>
                                                </div>
                                                
                                                <div className="report-card border rounded-lg p-6 cursor-pointer hover:shadow-lg" onClick={() => generateReport('detailed-analysis')}>
                                                    <div className="flex items-center mb-4">
                                                        <div className="p-3 bg-green-100 rounded-lg mr-4">
                                                            <div className="relative">
                                                                <FileSpreadsheet className="w-8 h-8 text-green-600" />
                                                                <Database className="w-4 h-4 absolute -top-1 -right-1 text-blue-500" />
                                                            </div>
                                                        </div>
                                                        <div>
                                                            <h4 className="text-lg font-semibold text-gray-900 flex items-center gap-2">
                                                                Detailed Analysis
                                                                <Layers className="w-4 h-4 text-green-500" />
                                                            </h4>
                                                            <p className="text-sm text-gray-500 flex items-center gap-1">
                                                                <Database className="w-3 h-3" />
                                                                Complete Excel export with all data
                                                            </p>
                                                        </div>
                                                    </div>
                                                    <div className="space-y-3 mb-4">
                                                        <p className="text-sm text-gray-600 flex items-center gap-2">
                                                            <List className="w-4 h-4 text-green-500" />
                                                            Complete match results with confidence scores
                                                        </p>
                                                        <p className="text-sm text-gray-600 flex items-center gap-2">
                                                            <Search className="w-4 h-4 text-yellow-500" />
                                                            Unmatched records analysis and recommendations
                                                        </p>
                                                        <p className="text-sm text-gray-600 flex items-center gap-2">
                                                            <TrendingUp className="w-4 h-4 text-blue-500" />
                                                            Performance metrics and business intelligence
                                                        </p>
                                                    </div>
                                                    <button 
                                                        disabled={generatingReport}
                                                        className="w-full inline-flex items-center justify-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-green-600 hover:bg-green-700 disabled:opacity-50 transition-all"
                                                    >
                                                        {generatingReport ? (
                                                            <RefreshCw className="w-4 h-4 mr-2 animate-spin" />
                                                        ) : (
                                                            <Download className="w-4 h-4 mr-2" />
                                                        )}
                                                        Download Excel File
                                                        <ExternalLink className="w-4 h-4 ml-2" />
                                                    </button>
                                                </div>
                                            </div>

                                            {/* Enhanced Business Metrics Dashboard */}
                                            <div className="bg-white border rounded-lg p-6">
                                                <h4 className="text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2">
                                                    <Activity className="w-5 h-5 text-blue-600" />
                                                    Performance Analytics
                                                    <span className="text-sm bg-gradient-to-r from-blue-100 to-purple-100 text-blue-800 px-2 py-1 rounded-full flex items-center gap-1">
                                                        <Zap className="w-3 h-3" />
                                                        Live Data
                                                    </span>
                                                </h4>
                                                <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                                                    <div className="text-center p-4 bg-gradient-to-br from-blue-50 to-blue-100 rounded-lg border border-blue-200 hover:shadow-md transition-all">
                                                        <div className="flex items-center justify-center mb-2">
                                                            <div className="p-2 bg-blue-200 rounded-full">
                                                                <DollarSign className="w-6 h-6 text-blue-700" />
                                                            </div>
                                                        </div>
                                                        <p className="text-2xl font-bold text-blue-600">${calculateBusinessMetrics(reconciliationResults.summary).costSavings}</p>
                                                        <p className="text-sm text-gray-600 flex items-center justify-center gap-1">
                                                            <ArrowUp className="w-3 h-3 text-green-500" />
                                                            Cost Savings
                                                        </p>
                                                    </div>
                                                    <div className="text-center p-4 bg-gradient-to-br from-green-50 to-green-100 rounded-lg border border-green-200 hover:shadow-md transition-all">
                                                        <div className="flex items-center justify-center mb-2">
                                                            <div className="p-2 bg-green-200 rounded-full">
                                                                <TrendingUp className="w-6 h-6 text-green-700" />
                                                            </div>
                                                        </div>
                                                        <p className="text-2xl font-bold text-green-600">{calculateBusinessMetrics(reconciliationResults.summary).roi}%</p>
                                                        <p className="text-sm text-gray-600 flex items-center justify-center gap-1">
                                                            <Award className="w-3 h-3 text-yellow-500" />
                                                            ROI
                                                        </p>
                                                    </div>
                                                    <div className="text-center p-4 bg-gradient-to-br from-purple-50 to-purple-100 rounded-lg border border-purple-200 hover:shadow-md transition-all">
                                                        <div className="flex items-center justify-center mb-2">
                                                            <div className="p-2 bg-purple-200 rounded-full">
                                                                <Clock className="w-6 h-6 text-purple-700" />
                                                            </div>
                                                        </div>
                                                        <p className="text-2xl font-bold text-purple-600">{calculateBusinessMetrics(reconciliationResults.summary).efficiencyGain}%</p>
                                                        <p className="text-sm text-gray-600 flex items-center justify-center gap-1">
                                                            <Zap className="w-3 h-3 text-purple-500" />
                                                            Efficiency Gain
                                                        </p>
                                                    </div>
                                                    <div className="text-center p-4 bg-gradient-to-br from-yellow-50 to-yellow-100 rounded-lg border border-yellow-200 hover:shadow-md transition-all">
                                                        <div className="flex items-center justify-center mb-2">
                                                            <div className="p-2 bg-yellow-200 rounded-full">
                                                                <Activity className="w-6 h-6 text-yellow-700" />
                                                            </div>
                                                        </div>
                                                        <p className="text-xl font-bold text-yellow-600">{calculateBusinessMetrics(reconciliationResults.summary).processingSpeed}</p>
                                                        <p className="text-sm text-gray-600 flex items-center justify-center gap-1">
                                                            <Cpu className="w-3 h-3 text-blue-500" />
                                                            Processing Speed
                                                        </p>
                                                    </div>
                                                </div>
                                            </div>

                                        </div>
                                    ) : (
                                        <div className="text-center py-12">
                                            <div className="flex justify-center mb-4">
                                                <div className="relative">
                                                    <FileText className="w-16 h-16 text-gray-400" />
                                                    <AlertCircle className="w-6 h-6 absolute -top-2 -right-2 text-blue-500 bg-white rounded-full border-2 border-blue-500" />
                                                </div>
                                            </div>
                                            <h4 className="text-lg font-medium text-gray-900 mb-2 flex items-center justify-center gap-2">
                                                <Info className="w-5 h-5 text-blue-600" />
                                                No Reconciliation Data Available
                                            </h4>
                                            <p className="text-gray-600 mb-6 flex items-center justify-center gap-1">
                                                <Search className="w-4 h-4" />
                                                Run a reconciliation to generate comprehensive reports and business intelligence.
                                            </p>
                                            <button
                                                onClick={() => setActiveTab('reconciliation')}
                                                className="inline-flex items-center px-6 py-3 border border-transparent text-base font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 transition-all"
                                            >
                                                <Play className="w-5 h-5 mr-2" />
                                                Start Reconciliation
                                                <ArrowRight className="w-5 h-5 ml-2" />
                                            </button>
                                        </div>
                                    )}
                                </div>

                                {/* Enhanced Report History */}
                                {reportHistory.length > 0 && (
                                    <div className="bg-white rounded-lg shadow">
                                        <div className="px-6 py-4 border-b border-gray-200">
                                            <h3 className="text-lg font-medium text-gray-900 flex items-center gap-2">
                                                <FolderOpen className="w-5 h-5 text-blue-600" />
                                                Report History
                                                <span className="text-sm bg-gray-100 text-gray-700 px-2 py-1 rounded-full flex items-center gap-1">
                                                    <Hash className="w-3 h-3" />
                                                    {reportHistory.length} reports
                                                </span>
                                            </h3>
                                        </div>
                                        <div className="p-6">
                                            <div className="space-y-4">
                                                {reportHistory.map((report) => (
                                                    <div key={report.id} className="flex items-center justify-between p-4 border rounded-lg hover:bg-gray-50 transition-all hover:shadow-md">
                                                        <div className="flex items-center space-x-4">
                                                            <div className={`p-2 rounded-lg ${report.type === 'Executive Summary' ? 'bg-blue-100' : 'bg-green-100'}`}>
                                                                {report.type === 'Executive Summary' ? (
                                                                    <FileText className="w-6 h-6 text-blue-600" />
                                                                ) : (
                                                                    <FileSpreadsheet className="w-6 h-6 text-green-600" />
                                                                )}
                                                            </div>
                                                            <div>
                                                                <p className="text-sm font-medium text-gray-900 flex items-center gap-2">
                                                                    {report.type}
                                                                    <span className="text-xs bg-blue-100 text-blue-800 px-2 py-1 rounded-full flex items-center gap-1">
                                                                        <CheckCircle className="w-3 h-3" />
                                                                        Complete
                                                                    </span>
                                                                </p>
                                                                <p className="text-xs text-gray-500 flex items-center gap-3">
                                                                    <span className="flex items-center gap-1">
                                                                        <Target className="w-3 h-3" />
                                                                        {report.matches} matches
                                                                    </span>
                                                                    <span className="flex items-center gap-1">
                                                                        <Percent className="w-3 h-3" />
                                                                        {report.matchRate}% rate
                                                                    </span>
                                                                    <span className="flex items-center gap-1">
                                                                        <Clock className="w-3 h-3" />
                                                                        {report.timeSaved}h saved
                                                                    </span>
                                                                </p>
                                                            </div>
                                                        </div>
                                                        <div className="flex items-center space-x-3">
                                                            <span className="text-xs text-gray-500 flex items-center gap-1">
                                                                <Calendar className="w-3 h-3" />
                                                                {formatDate(report.createdAt)}
                                                            </span>
                                                            <button className="p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-lg transition-colors">
                                                                <Download className="w-4 h-4" />
                                                            </button>
                                                            <button className="p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-lg transition-colors">
                                                                <Share className="w-4 h-4" />
                                                            </button>
                                                            <button className="p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-lg transition-colors">
                                                                <MoreHorizontal className="w-4 h-4" />
                                                            </button>
                                                        </div>
                                                    </div>
                                                ))}
                                            </div>
                                        </div>
                                    </div>
                                )}
                            </div>
                        )}
                    </div>
                </div>
            );
        };

        // Enhanced render with error boundary
        try {
            ReactDOM.render(<IntegratedMedSpaSyncDashboard />, document.getElementById('dashboard-root'));
            console.log('🎨 Enterprise dashboard with comprehensive icon system rendered successfully');
        } catch (error) {
            console.error('Failed to render dashboard:', error);
            document.getElementById('dashboard-root').innerHTML = `
                <div class="flex items-center justify-center min-h-screen bg-gray-50">
                    <div class="text-center">
                        <div class="w-16 h-16 mx-auto mb-4 bg-red-100 rounded-full flex items-center justify-center">
                            <svg class="w-8 h-8 text-red-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.082 16.5c-.77.833.192 2.5 1.732 2.5z"></path>
                            </svg>
                        </div>
                        <h2 class="text-xl font-semibold text-gray-900">Dashboard Error</h2>
                        <p class="mt-2 text-gray-600">Failed to load the dashboard. Please refresh the page.</p>
                        <button onclick="location.reload()" class="mt-4 px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 transition-colors flex items-center gap-2 mx-auto">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
                            </svg>
                            Refresh Page
                        </button>
                    </div>
                </div>
            `;
        }
    </script>
</body>
</html>
